<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oregon Arm Wrestling Rankings</title>
  <style>
    :root{ --bg:#0b0f0c; --panel:#121712; --muted:#8da08f; --text:#e9f0ea; --accent:#1e7f4b; --accent2:#f8d24b; --radius:14px }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;background:rgba(11,15,12,.8);backdrop-filter:blur(8px);border-bottom:1px solid rgba(248,210,75,.18)}
    header .bar{display:flex;justify-content:space-between;align-items:center;padding:12px 24px}
    h1{margin:16px 0 6px;font-size:28px}
    p.lead{margin:0 0 12px;color:var(--muted)}
    .panel{background:linear-gradient(180deg,rgba(18,23,18,.9),rgba(18,23,18,.8));border:1px solid rgba(248,210,75,.16);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.35);margin-top:18px;overflow:hidden}
    .panel > .hd{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid rgba(248,210,75,.16)}
    .panel h2{margin:0;font-size:18px}
    .sub{color:var(--muted);font-size:14px}
    .wrap{overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:15px}
    thead th{position:sticky;top:0;background:#0e140f;color:var(--muted);text-align:left;padding:10px 12px;border-bottom:1px solid rgba(248,210,75,.16)}
    tbody td{padding:12px;border-bottom:1px solid rgba(248,210,75,.08);background:linear-gradient(180deg,#0e140f,#0f1611)}
    tbody tr:hover td{background:#0f1912}
    td.rank{font-weight:800;color:var(--accent2)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px}
    .card{border:1px solid rgba(248,210,75,.16);border-radius:var(--radius);overflow:hidden}
    .card .card-hd{padding:10px 12px;background:#0f1611;border-bottom:1px solid rgba(248,210,75,.12);font-weight:800}
    .empty{padding:12px;color:var(--muted)}
    .notice{margin-top:10px;color:var(--muted);font-size:12px}
    code{background:#0f1611;border:1px solid rgba(248,210,75,.2);padding:2px 6px;border-radius:6px}
    @media(max-width:760px){thead{display:none}table,tbody,tr,td{display:block;width:100%}tbody tr{margin:10px;border:1px solid rgba(248,210,75,.14);border-radius:10px;overflow:hidden}tbody td{display:flex;justify-content:space-between;gap:12px}tbody td::before{content:attr(data-label);color:var(--muted);font-weight:700}}
  </style>
</head>
<body>
  <header>
    <div class="bar"><strong>Oregon Arm Wrestling Rankings</strong><span class="sub">Live from Google Sheets</span></div>
  </header>

  <main class="container">
    <section class="panel">
      <div class="hd"><h2>Overall Rankings — Right & Left</h2><div class="sub">Edit your sheet → page auto‑updates</div></div>
      <div class="wrap">
        <table id="overall-table">
          <thead>
            <tr><th>#</th><th>Left Hand</th><th>Right Hand</th></tr>
          </thead>
          <tbody><tr><td colspan="3">Loading…</td></tr></tbody>
        </table>
      </div>
    </section>

    <section class="panel">
      <div class="hd"><h2>Weight‑Class Rankings — Right Arm</h2><div class="sub">154 • 176 • 198 • 220 • 242 • 243+</div></div>
      <div class="grid" id="wc-right"></div>
    </section>

    <section class="panel">
      <div class="hd"><h2>Weight‑Class Rankings — Left Arm</h2><div class="sub">154 • 176 • 198 • 220 • 242 • 243+</div></div>
      <div class="grid" id="wc-left"></div>
    </section>

    <p class="notice">Share your Google Sheet as <strong>Anyone with the link: Viewer</strong> (no publishing required). Paste the <code>SHEET_ID</code> and tab names below. The code uses the Google Visualization (GViz) endpoint to fetch live CSV for each tab.</p>
  </main>

  <script>
    // === LIVE GOOGLE SHEETS CONFIG ===
    // ONE spreadsheet with two tabs. Set these three values:
    const SHEET_ID = 'https://docs.google.com/spreadsheets/d/1aD3ZFkMHCrg4lZe80lONyQz-MsEVStelCiCEyHb6-2Y/edit?usp=sharing';
    const RANKINGS_TAB_NAME = 'Rankings';   // columns: A=Left, C=Right
    const WEIGHTS_TAB_NAME  = 'Weights';    // columns: A=Name, B=Weight lbs

    // Build GViz CSV URLs
    const gvizCsv = (tab) => `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(tab)}`;

    // ---- helpers ----
    const csvToRows = (csv) => csv.trim().split(/
?
/).map(r=>{
      // Robust CSV split to keep simple: handle quoted commas
      const out=[]; let cur=''; let q=false;
      for(let i=0;i<r.length;i++){
        const ch=r[i];
        if(ch==='"') { q=!q; continue; }
        if(ch===',' && !q){ out.push(cur); cur=''; } else { cur+=ch; }
      }
      out.push(cur); return out.map(s=>s.trim());
    });
    const by = (fn) => (a,b) => (fn(a)<fn(b)?-1:fn(a)>fn(b)?1:0);

    function weightClass(lbs){
      if (lbs === '' || lbs === null || Number.isNaN(Number(lbs))) return '243+'; // unknown → superheavy
      const w = Number(lbs);
      if (w === -1) return '243+';
      if (w <= 154) return '154';
      if (w <= 176) return '176';
      if (w <= 198) return '198';
      if (w <= 220) return '220';
      if (w <= 242) return '242';
      return '243+';
    }

    async function load(){
      const [rankCSV, wtCSV] = await Promise.all([
        fetch(gvizCsv(RANKINGS_TAB_NAME)).then(r=>r.text()),
        fetch(gvizCsv(WEIGHTS_TAB_NAME)).then(r=>r.text())
      ]);

      // Rankings sheet (Left col A, Right col C)
      const rRows = csvToRows(rankCSV);
      const left = rRows.slice(1).map(r => r[0]).filter(Boolean);
      const right = rRows.slice(1).map(r => r[2]).filter(Boolean);

      // Weights sheet → map name -> weight class
      const wRows = csvToRows(wtCSV);
      const weights = new Map();
      wRows.slice(1).forEach(r => {
        const name = (r[0]||'').trim();
        if(!name) return;
        const lbs = r[1]!==undefined ? r[1] : '';
        weights.set(name, weightClass(lbs));
      });

      renderOverall(left,right);
      renderWeightClasses('wc-right', right, weights);
      renderWeightClasses('wc-left', left, weights);
    }

    function renderOverall(left,right){
      const n = Math.max(left.length, right.length);
      const tbody = document.querySelector('#overall-table tbody');
      tbody.innerHTML = '';
      for(let i=0;i<n;i++){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="rank" data-label="#">${i+1}</td>
                        <td data-label="Left">${left[i]||''}</td>
                        <td data-label="Right">${right[i]||''}</td>`;
        tbody.appendChild(tr);
      }
    }

    function renderWeightClasses(containerId, armList, weights){
      const rankIndex = new Map(armList.map((n,i)=>[n,i+1]));
      const classes = ['154','176','198','220','242','243+'];
      const groups = new Map(classes.map(c=>[c,[]]));

      armList.forEach(name => {
        const cls = weights.get(name) || '243+'; // default superheavy if missing
        groups.get(cls).push({ name, rank: rankIndex.get(name)});
      });

      const grid = document.getElementById(containerId);
      grid.innerHTML='';
      classes.forEach(cls => {
        const list = groups.get(cls).sort(by(x=>x.rank)); // keep overall order
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<div class="card-hd">${cls === '243+' ? 'Superheavyweight (243+)' : cls + ' lbs'}</div>`;
        if(list.length===0){
          const empty = document.createElement('div');
          empty.className='empty';
          empty.textContent = 'No ranked athletes yet.';
          card.appendChild(empty);
        } else {
          const wrap = document.createElement('div');
          wrap.className='wrap';
          const table = document.createElement('table');
          table.innerHTML = `<thead><tr><th>#</th><th>Athlete</th></tr></thead><tbody></tbody>`;
          const tb = table.querySelector('tbody');
          list.forEach((x,i)=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="rank" data-label="#">${i+1}</td><td data-label="Athlete">${x.name}</td>`;
            tb.appendChild(tr);
          });
          wrap.appendChild(table);
          card.appendChild(wrap);
        }
        grid.appendChild(card);
      });
    }

    load().catch(err => {
      console.error(err);
      document.querySelector('#overall-table tbody').innerHTML = '<tr><td colspan="3">Failed to load Google Sheets data. Check your Sheet ID / tab names and sharing permissions.</td></tr>'
    });
  </script>
</body>
</html>
