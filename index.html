<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oregon Arm Wrestling Rankings</title>
  <style>
    :root{
      --bg:#070e1c;
      --panel:#0b1630;
      --panel-2:#081228;
      --text:#e6ecfa;
      --muted:#9eabc9;
      --accent:#d7b43a;
      --accent-2:#b99322;
      --chip:#0f1d3f;
      --border: rgba(255,255,255,.08);
      --glow: 0 10px 30px rgba(215,180,58,.14);
      --radius: 14px;
      --silver: #c0c0c0;
      --bronze: #cd7f32;
      --header-bg: #0a2a40; /* dark turquoise-blue */
    }

    *{box-sizing:border-box}
    html, body{
      margin:0;max-width:100%;overflow-x:hidden;
      background:
        radial-gradient(80vw 60vh at 100% -20%, rgba(215,180,58,.10), transparent 60%),
        radial-gradient(60vw 40vh at 0% 0%, rgba(15,29,63,.32), transparent 65%),
        var(--bg);
      color:var(--text);font-family:Inter,system-ui,Arial,sans-serif
    }
    .container{width:min(1100px,100%);margin:0 auto;padding-inline:clamp(12px,3vw,24px);padding-block:24px}

    header{position:sticky;top:0;z-index:20;backdrop-filter:blur(8px);background:linear-gradient(180deg, rgba(7,14,28,.92), rgba(7,14,28,.55));border-bottom:1px solid var(--border)}
    .bar{display:flex;gap:14px;align-items:center;justify-content:space-between;padding:12px 24px}
    .brand{display:flex;gap:12px;align-items:center;font-weight:800}
    .crest{width:38px;height:38px;border-radius:10px;background:conic-gradient(from 220deg,var(--accent),var(--accent) 50%,var(--accent-2) 50%,var(--accent-2));box-shadow:var(--glow)}

    .chips{display:flex;gap:6px;flex-wrap:wrap;margin:0}
    .chip{border:1px solid var(--border);background:var(--panel);color:var(--muted);padding:6px 10px;border-radius:999px;font-weight:700;cursor:pointer;transition:.2s ease;line-height:1}
    .chip:hover{color:var(--text)}
    .chip[aria-pressed="true"]{color:#070e1c;background:linear-gradient(180deg,var(--accent),var(--accent-2));border-color:transparent;box-shadow:0 6px 18px rgba(215,180,58,.18)}

    .opt{display:flex;align-items:center;gap:8px;color:var(--muted);font-weight:700}
    .opt input{accent-color:var(--accent)}

    .panel{background:linear-gradient(180deg, rgba(11,22,48,.94), rgba(8,18,40,.92));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--glow);margin-top:18px;overflow:hidden}
    .panel .hd{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border)}
    .subbar{position:sticky; top:0; z-index:5; background:var(--header-bg); border-bottom:1px solid var(--border); padding:10px 16px; display:flex; align-items:center; gap:12px}
    .subpill{font-weight:800; border:1px solid rgba(215,180,58,.22); background:linear-gradient(180deg,rgba(215,180,58,.18),rgba(185,147,34,.16)); color:var(--text); padding:6px 10px; border-radius:999px}
    .wrap{overflow-x:hidden; overflow-y:auto}

    table{width:100%;max-width:100%;border-collapse:collapse;font-size:15px; table-layout:auto}
    thead th{background:var(--header-bg);color:var(--muted);text-align:left;padding:10px 12px;border-bottom:1px solid var(--border)}
    tbody td{padding:10px 12px;border-bottom:1px solid var(--border);min-width:0;word-break:break-word;background:transparent}
    tbody tr:hover td{background:rgba(10,23,64,.35)}
    td.rank{font-weight:900;color:var(--accent); text-align:center; width:52px; min-width:52px }
    td.athlete{min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}

    @media(max-width:760px){
      .chips{gap:4px}
      .chip{padding:6px 8px; font-size:0.92rem}
      thead{display:none}
      table,tbody,tr,td{display:block;width:100%}
      tbody tr{margin:8px;border:1px solid var(--border);border-radius:10px;overflow:hidden}
      tbody td{display:flex;justify-content:space-between;gap:10px}
      tbody td::before{display:none}
      .subbar{top:0}
      td.rank{justify-content:center}
      #weights-table tbody tr{display:grid; grid-template-columns:minmax(0,1fr) 46px minmax(0,1fr); align-items:center}
      #weights-table tbody td{display:block; padding:10px 8px}
    }
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand"><div class="crest"></div> Oregon Arm Wrestling Rankings</div>
    </div>
  </header>

  <main class="container">
    <section id="view-weights" class="panel" role="region" aria-label="Weight classes">
      <div class="hd">
        <div class="chips" role="group" aria-label="Weight class">
          <button class="chip" data-cls="154" aria-pressed="false">154</button>
          <button class="chip" data-cls="176" aria-pressed="false">176</button>
          <button class="chip" data-cls="198" aria-pressed="false">198</button>
          <button class="chip" data-cls="220" aria-pressed="false">220</button>
          <button class="chip" data-cls="242" aria-pressed="false">242</button>
          <button class="chip" data-cls="243+" aria-pressed="true">243+</button>
        </div>
        <label class="opt"><input id="opt-lower" type="checkbox" checked/> Combine with lower weight classes</label>
      </div>

      <div class="subbar">
        <span id="sticky-label" class="subpill">243+ lbs</span>
      </div>

      <div class="wrap">
        <table id="weights-table">
          <thead>
            <tr><th>Left</th><th>#</th><th>Right</th></tr>
          </thead>
          <tbody><tr><td colspan="3">Loadingâ€¦</td></tr></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const SHEET_ID_RAW = 'https://docs.google.com/spreadsheets/d/1aD3ZFkMHCrg4lZe80lONyQz-MsEVStelCiCEyHb6-2Y/edit?usp=sharing';
    const RANKINGS_TAB_NAME = 'Rankings';
    const WEIGHTS_TAB_NAME  = 'Weights';

    const SHEET_ID = (()=>{ const m=String(SHEET_ID_RAW).match(/\/d\/([a-zA-Z0-9-_]+)/); return m?m[1]:String(SHEET_ID_RAW).trim(); })();
    const gvizCsv = (tab) => `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(tab)}`;

    const csvToRows = (csv) => csv.trim().split(/\r?\n/).map(line => {const out=[];let cur='';let q=false;for(let i=0;i<line.length;i++){const ch=line[i];if(ch==='"'){q=!q;continue;}if(ch===','&&!q){out.push(cur);cur='';}else{cur+=ch;}}out.push(cur);return out.map(s=>s.trim());});
    const by = (fn) => (a,b) => (fn(a)<fn(b)?-1:fn(a)>fn(b)?1:0);

    function weightClass(lbs){ if(lbs===''||lbs===null||Number.isNaN(Number(lbs))) return '243+'; const w=Number(lbs); if(w===-1) return '243+'; if(w<=154)return'154'; if(w<=176)return'176'; if(w<=198)return'198'; if(w<=220)return'220'; if(w<=242)return'242'; return'243+'; }

    let LEFT=[], RIGHT=[], WEIGHT_MAP=new Map(), GROUPS={right:new Map(), left:new Map()};
    const CLASSES=['154','176','198','220','242','243+'];

    async function load(){
      const [rankCSV, wtCSV] = await Promise.all([
        fetch(gvizCsv(RANKINGS_TAB_NAME)).then(r=>r.text()),
        fetch(gvizCsv(WEIGHTS_TAB_NAME)).then(r=>r.text())
      ]);

      const rRows = csvToRows(rankCSV);
      LEFT  = rRows.slice(1).map(r=>r[0]).filter(Boolean);
      RIGHT = rRows.slice(1).map(r=>r[2]).filter(Boolean);

      const wRows = csvToRows(wtCSV);
      WEIGHT_MAP = new Map();
      wRows.slice(1).forEach(r=>{ const name=(r[0]||'').trim(); if(!name) return; const lbs = r[1]!==undefined ? r[1] : ''; WEIGHT_MAP.set(name, weightClass(lbs)); });

      GROUPS.right = buildGroups(RIGHT);
      GROUPS.left  = buildGroups(LEFT);

      const vw=document.getElementById('view-weights'); vw.dataset.cls='243+';
      renderWeights('243+');
    }

    function buildGroups(armList){
      const idx = new Map(armList.map((n,i)=>[n,i+1]));
      const map = new Map(CLASSES.map(c=>[c,[]]));
      armList.forEach(name=>{ const cls=WEIGHT_MAP.get(name)||'243+'; map.get(cls).push({name, rank: idx.get(name), cls}); });
      CLASSES.forEach(c=> map.get(c).sort(by(x=>x.rank)));
      return map;
    }

    function classesToCombine(cls){
      const i = CLASSES.indexOf(cls);
      return CLASSES.slice(0, i+1);
    }

    function getList(arm, cls, combineLower){
      if(combineLower){
        const pool = classesToCombine(cls).flatMap(c => GROUPS[arm].get(c) || []);
        return pool.sort(by(x=>x.rank));
      }
      return (GROUPS[arm].get(cls) || []).slice();
    }

    function updateStickyLabel(){
      const cls = document.getElementById('view-weights').dataset.cls || '243+';
      const withLower = document.getElementById('opt-lower').checked;
      const extra = withLower && cls!=='154' ? ' + lower' : '';
      document.getElementById('sticky-label').textContent = `${cls==='243+'?'243+ lbs':cls+' lbs'}${extra}`;
    }

    function animateSwap(tb){
      tb.classList.remove('swap'); void tb.offsetWidth; tb.classList.add('swap');
      tb.addEventListener('animationend', ()=> tb.classList.remove('swap'), {once:true});
    }

    function renderWeights(cls){
      document.querySelectorAll('.chips .chip').forEach(c=>c.setAttribute('aria-pressed', String(c.dataset.cls===cls)));

      const combineLower = document.getElementById('opt-lower').checked;
      const tb = document.querySelector('#weights-table tbody');
      tb.innerHTML = '';

      const leftList  = getList('left',  cls, combineLower);
      const rightList = getList('right', cls, combineLower);
      const n = Math.max(leftList.length, rightList.length);

      for(let i=0;i<n;i++){
        const rank = i+1;
        const leftName  = leftList[i]?.name  || '';
        const rightName = rightList[i]?.name || '';
        const tr = document.createElement('tr');
        if(rank<=3){ tr.classList.add('shimmer'); if(rank===1) tr.classList.add('top1'); else if(rank===2) tr.classList.add('top2'); else tr.classList.add('top3'); }
        tr.innerHTML = `<td class="athlete">${leftName}</td><td class="rank">${rank}</td><td class="athlete">${rightName}</td>`;
        tb.appendChild(tr);
      }

      document.getElementById('view-weights').dataset.cls = cls;
      updateStickyLabel();
      animateSwap(tb);
    }

    document.querySelectorAll('.chips .chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{ renderWeights(btn.dataset.cls); });
    });

    const optLower = document.getElementById('opt-lower');
    if(optLower){ optLower.addEventListener('change', ()=>{
      const cls = document.getElementById('view-weights').dataset.cls || '243+';
      renderWeights(cls);
    }); }

    load().catch(e=>{
      console.error(e);
      const tb=document.querySelector('#weights-table tbody');
      tb.innerHTML = '<tr><td colspan="3">Failed to load Google Sheets data.</td></tr>';
    });
  </script>
</body>
</html>
